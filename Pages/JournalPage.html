<!doctype html>
<html>
  <head>
    <title>AnonyMask | Journal</title>
    <link rel="stylesheet" href="../Designs/homePage.css" />
    <link rel="stylesheet" href="../Designs/journalPage.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Card Actions Layout */
      .card-actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
        padding-top: 15px;
      }

      .action-btn {
        flex: 1;
        padding: 10px;
        border-radius: 6px;
        font-weight: 800;
        font-size: 0.8rem;
        cursor: pointer;
        transition: transform 0.1s;
        text-align: center;
        border: none;
      }

      /* VIEW BUTTON: Solid Main Color (High Contrast) */
      .view-btn {
        background: var(--main-color);
        color: white;
        box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
      }
      .view-btn:hover {
        background: #1e293b;
        transform: translateY(-1px);
      }

      /* DELETE BUTTON: Solid Red (Restored) */
      .delete-btn {
        background: #ef4444;
        color: white;
        box-shadow: 2px 2px 0px rgba(185, 28, 28, 0.2);
      }
      .delete-btn:hover {
        background: #dc2626;
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <div class="nav-wrapper">
      <div class="nav-option">
        <input
          value="home"
          name="btn"
          type="radio"
          class="nav-input"
          onclick="location.href = 'HomePage.html'"
        />
        <div class="nav-btn"><span class="nav-span">Home</span></div>
      </div>
      <div class="nav-option">
        <input
          value="paint"
          name="btn"
          type="radio"
          class="nav-input"
          onclick="location.href = 'PaintPage.html'"
        />
        <div class="nav-btn"><span class="nav-span">Paint</span></div>
      </div>
      <div class="nav-option">
        <input
          checked=""
          value="journal"
          name="btn"
          type="radio"
          class="nav-input"
          onclick="location.href = 'JournalPage.html'"
        />
        <div class="nav-btn"><span class="nav-span">Journal</span></div>
      </div>
      <div class="nav-option">
        <input
          value="support"
          name="btn"
          type="radio"
          class="nav-input"
          onclick="location.href = 'SupportPage.html'"
        />
        <div class="nav-btn"><span class="nav-span">Support</span></div>
      </div>
    </div>

    <div class="settings-btn" onclick="location.href = 'SettingsPage.html'">
      <img
        src="../Designs/setting.png"
        alt="Settings"
        style="height: 20px; width: 20px"
      />
    </div>

    <main class="content-container">
      <h1 class="gallery-header">YOUR EMOTION LOG</h1>
      <div id="journalGrid" class="journal-grid"></div>
    </main>

    <script>
      const STORAGE_KEY = "whitemask_journal_entries";

      function renderJournal() {
        const grid = document.getElementById("journalGrid");
        const entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

        if (entries.length === 0) {
          grid.innerHTML = `<div class="empty-state">
            <h2>No entries yet</h2>
            <p>Go to the Paint page to create your first emotion mask.</p>
            <button onclick="location.href='PaintPage.html'" style="margin-top:20px; padding:12px 24px; background:var(--main-color); color:white; border:none; border-radius:30px; cursor:pointer; font-weight:800;">Start Painting</button>
          </div>`;
          return;
        }

        // Passing ID as string to ensure precision
        grid.innerHTML = entries
          .map(
            (entry) => `
            <div class="journal-card">
                <div class="entry-header">
                    <span class="entry-date">${entry.date}</span>
                    <span class="entry-emotion-badge" style="background-color: ${entry.color || "#ccc"}">${entry.emotion || "Unknown"}</span>
                </div>
                <img src="${entry.image}" class="entry-img" alt="Mask Design">
                <div class="entry-note">"${entry.note || "No notes added."}"</div>
                
                <div class="card-actions">
                    <button class="action-btn view-btn" onclick="viewEntry('${entry.id}')">View in Studio</button>
                    <button class="action-btn delete-btn" onclick="deleteEntry(${entry.id})">Delete</button>
                </div>
            </div>
        `,
          )
          .join("");
      }

      function deleteEntry(id) {
        if (confirm("Are you sure you want to delete this entry?")) {
          let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
          // Using strict inequality might fail if types differ (string vs number), so we use filter carefully
          entries = entries.filter((e) => e.id != id);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
          renderJournal();
        }
      }

      function viewEntry(id) {
        localStorage.setItem("whitemask_load_request", id);
        window.location.href = "PaintPage.html";
      }

      window.onload = renderJournal;
    </script>
  </body>
</html>
