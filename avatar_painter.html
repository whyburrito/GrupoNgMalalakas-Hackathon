<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detailed Anime Orbit Painter</title>
    <style>
      :root {
<<<<<<< Updated upstream
        --bg-color: #e0e0e0;
        --sidebar-width: 300px;
        /* Avatar Colors */
        --skin-color: #ffcc99;
        --shirt-color: #3498db;
        --pants-color: #2c3e50;
        --hair-color: #3e2723;
        --mask-color: #333;
        --shoes-color: #1a1a1a;
=======
        /* Define Base Colors - Gradients will use these */
        --skin-base: #fff0e0;
        --hair-base: #2c3e50;
        --hair-highlight: #4a698a;
        --eye-base: #3498db;
        --eye-dark: #21618c;
        --accent: #e74c3c;
>>>>>>> Stashed changes
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        overflow: hidden;
        font-family: "Segoe UI", sans-serif;
        display: flex;
        height: 100vh;
        background: #121212;
        color: #eee;
      }

      /* --- SIDEBAR --- */
      #sidebar {
        width: 260px;
        background: #1e1e1e;
        padding: 25px;
        box-shadow: 5px 0 20px rgba(0, 0, 0, 0.5);
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 15px;
        border-right: 1px solid #333;
      }

      h3 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--eye-base);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .group {
        background: #2a2a2a;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #3a3a3a;
      }
      label {
        display: block;
        font-size: 11px;
        text-transform: uppercase;
        color: #aaa;
        margin-bottom: 8px;
        font-weight: 700;
      }

      input[type="color"],
      input[type="range"],
      select {
        width: 100%;
        background: #121212;
        border: 1px solid #444;
        color: white;
        border-radius: 6px;
        padding: 8px;
        box-sizing: border-box;
        outline: none;
      }
      input[type="color"] {
        padding: 2px;
        height: 35px;
      }

      button {
        padding: 12px;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        background: linear-gradient(135deg, var(--eye-base), var(--eye-dark));
        color: white;
        transition: 0.3s;
      }
      button:hover {
        filter: brightness(1.1);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }
      button.clear {
        background: #444;
        margin-top: auto;
      }

      /* --- CANVAS --- */
      #canvasContainer {
        flex-grow: 1;
        position: relative;
        cursor: crosshair;
        background: #f0f2f5;
        overflow: hidden;
      }
      canvas {
        display: block;
      }

<<<<<<< Updated upstream
      /* --- AVATAR WRAPPER (Follows Mouse) --- */
      #avatarWrapper {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none; /* Allows clicking THROUGH avatar */
        transform-style: preserve-3d;
        z-index: 100;
        transition: transform 0.05s linear;
      }

      /* Scale down the Robust Avatar for the tool */
      #pivot {
        position: relative;
        transform-style: preserve-3d;
        transform: scale(0.35) rotateX(-20deg) rotateY(25deg);
      }

      /* --- ROBUST CUBOID ENGINE (From avatar.html) --- */
      .cuboid {
        position: absolute;
        transform-style: preserve-3d;
      }
      
      .face {
        position: absolute;
        backface-visibility: hidden;
        outline: 1px solid rgba(0,0,0,0.03); 
      }

      /* Standard mapping based on CSS Vars --w, --h, --d */
      .cuboid .front  { width: var(--w); height: var(--h); transform: translateZ(calc(var(--d) / 2)); }
      .cuboid .back   { width: var(--w); height: var(--h); transform: rotateY(180deg) translateZ(calc(var(--d) / 2)); }
      .cuboid .right  { 
        width: var(--d); height: var(--h); 
        left: calc((var(--w) - var(--d)) / 2); 
        transform: rotateY(90deg) translateZ(calc(var(--w) / 2)); 
      }
      .cuboid .left   { 
        width: var(--d); height: var(--h); 
        left: calc((var(--w) - var(--d)) / 2); 
        transform: rotateY(-90deg) translateZ(calc(var(--w) / 2)); 
      }
      .cuboid .top    { 
        width: var(--w); height: var(--d); 
        top: calc((var(--h) - var(--d)) / 2); 
        transform: rotateX(90deg) translateZ(calc(var(--h) / 2)); 
      }
      .cuboid .bottom { 
        width: var(--w); height: var(--d); 
        top: calc((var(--h) - var(--d)) / 2); 
        transform: rotateX(-90deg) translateZ(calc(var(--h) / 2)); 
      }

      /* Lighting */
      .front { filter: brightness(1.0); }
      .back { filter: brightness(0.6); }
      .right, .left { filter: brightness(0.75); }
      .top { filter: brightness(1.15); }
      .bottom { filter: brightness(0.4); }

      /* --- AVATAR PARTS --- */
      
      /* BODY */
      .body {
        --w: 60px; --h: 70px; --d: 30px;
        transform: translate3d(-30px, -70px, 0); 
      }
      .body .face { background: var(--shirt-color); }
      .body .top { background: var(--skin-color); } 

      /* NECK */
      .neck {
        --w: 20px; --h: 10px; --d: 20px;
        transform: translate3d(-10px, -80px, 0);
      }
      .neck .face { background: var(--skin-color); filter: brightness(0.85); }

      /* HEAD */
      .head {
        --w: 60px; --h: 60px; --d: 60px;
        transform: translate3d(-30px, -140px, 0);
      }
      .head .face { background: var(--skin-color); }
      
      /* Face Details */
      .eye { position: absolute; width: 10px; height: 10px; background: #222; top: 25px; border-radius: 50%; }
      .eye.l { left: 12px; }
      .eye.r { right: 12px; }
      /* Mouth removed in favor of brush concentration, or keep small line */
      .mouth { position: absolute; width: 24px; height: 6px; background: #a55; top: 45px; left: 18px; border-radius: 4px; }

      /* HAIR */
      .hair {
        --w: 64px; --h: 20px; --d: 64px;
        transform: translate3d(-32px, -150px, 0);
      }
      .hair .face { background: var(--hair-color); }
      .hair-back {
        --w: 64px; --h: 30px; --d: 64px;
        transform: translate3d(-32px, -135px, 0);
      }
      .hair-back .face { background: var(--hair-color); }
      .hair-back .front, .hair-back .bottom { display: none; } 

      /* ARMS */
      .arm {
        --w: 20px; --h: 70px; --d: 20px;
        transform-origin: 50% 10px; 
      }
      .arm .face { background: var(--skin-color); }
      .arm .top, .arm .top + div { background: var(--shirt-color); } 
      .arm .top { background: var(--shirt-color); }

      .arm.left { transform: translate3d(-50px, -65px, 0); }
      .arm.right { transform: translate3d(30px, -65px, 0); }

      /* LEGS */
      .leg {
        --w: 24px; --h: 70px; --d: 24px;
        transform-origin: 50% 0; 
      }
      .leg .face { background: var(--pants-color); }
      .leg .bottom { background: var(--shoes-color); }

      .leg.left { transform: translate3d(-28px, 0, 0); }
      .leg.right { transform: translate3d(4px, 0, 0); }


      /* --- PAINTER SPECIFIC MODS --- */

      /* BRUSH (Attached to Right Arm) */
      .brush {
        position: absolute;
        width: 12px;
        height: 80px;
        background: #8e44ad;
        /* Position at hand: bottom of arm (y=70), center of arm width (10), shifted forward */
        transform: translate3d(4px, 60px, -20px) rotateX(90deg);
        transform-origin: 50% 0;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      }
      /* Tip of brush */
      .brush::after {
        content: "";
        position: absolute;
        bottom: 0; left: 0;
        width: 100%; height: 20px;
        background: inherit;
        filter: brightness(1.5); /* lighter tip */
      }

      /* MASK STYLES (Adapted for 3D Head) */
      .mask-ninja .head .face.front::after {
        content: "";
        position: absolute;
        bottom: 0; left: 0;
        width: 100%; height: 50%;
        background: var(--mask-color);
        z-index: 2;
      }
      .mask-hero .head .face.front::before {
        content: "";
        position: absolute;
        top: 15px; left: 0;
        width: 100%; height: 20px;
        background: var(--mask-color);
        z-index: 2;
      }

      /* ANIMATIONS */
      .walking .leg.left { animation: walk 0.4s infinite alternate; }
      .walking .leg.right { animation: walk 0.4s infinite alternate-reverse; }
      .walking .arm.left { animation: swing 0.4s infinite alternate; }
      
      /* Right arm holds the brush steady-ish while walking */
      .walking .arm.right {
        /* Lift arm up to paint */
        transform: translate3d(30px, -65px, 0) rotateX(-90deg);
        animation: paint-bob 0.2s infinite alternate;
      }

      .walking .body, .walking .head, .walking .hair, .walking .neck, .walking .hair-back {
        animation: bounce 0.2s infinite alternate;
      }

      @keyframes walk {
        from { transform: translate3d(var(--tx, -28px), 0, 0) rotateX(25deg); }
        to { transform: translate3d(var(--tx, -28px), 0, 0) rotateX(-25deg); }
      }
      .leg.left { --tx: -28px; }
      .leg.right { --tx: 4px; }

      @keyframes swing {
        from { transform: translate3d(-50px, -65px, 0) rotateX(-25deg); }
        to { transform: translate3d(-50px, -65px, 0) rotateX(25deg); }
      }

      @keyframes paint-bob {
        from { transform: translate3d(30px, -65px, 0) rotateX(-85deg); }
        to { transform: translate3d(30px, -65px, 0) rotateX(-95deg); }
      }

      @keyframes bounce {
        from { transform: translate3d(var(--bx, 0), var(--by, 0), 0); }
        to { transform: translate3d(var(--bx, 0), calc(var(--by, 0) - 2px), 0); }
=======
      /* --- ANIME AVATAR CONTAINER --- */
      #vtuberContainer {
        position: absolute;
        width: 180px;
        height: 180px; /* Slightly larger for detail */
        pointer-events: none;
        z-index: 50;
        transform: translate(-50%, -50%);
        /* Soft glow effect */
        filter: drop-shadow(0 0 15px rgba(52, 152, 219, 0.3));
      }

      .hidden {
        display: none;
>>>>>>> Stashed changes
      }
      
      .body { --bx: -30px; --by: -70px; }
      .neck { --bx: -10px; --by: -80px; }
      .head { --bx: -30px; --by: -140px; }
      .hair { --bx: -32px; --by: -150px; }
      .hair-back { --bx: -32px; --by: -135px; }

    </style>
  </head>
  <body>
    <div id="sidebar">
      <h3>Pro Artist Interface</h3>

<<<<<<< Updated upstream
      <div class="section-title">Brush Settings</div>
      <label>Color: <input type="color" id="brushColor" value="#ff0000" /></label>
      <label>Size: <input type="range" id="brushSize" min="5" max="50" value="10" /></label>
      <label>Shape:
        <select id="brushShape">
          <option value="round">Circle</option>
          <option value="square">Square</option>
=======
      <div class="group">
        <label>Brush Ink</label>
        <input type="color" id="brushColor" value="#2c3e50" />
        <label style="margin-top: 15px">Brush Flow/Size</label>
        <input type="range" id="brushSize" min="2" max="40" value="8" />
      </div>

      <div class="group">
        <label>Avatar Mask</label>
        <select id="maskType">
          <option value="none">None - Standard</option>
          <option value="kitsune">Anbu Kitsune</option>
>>>>>>> Stashed changes
        </select>
      </div>

<<<<<<< Updated upstream
      <div class="section-title">Avatar Disguise</div>
      <label>Mask Type:
        <select id="maskSelect">
          <option value="none">None</option>
          <option value="mask-ninja">Ninja</option>
          <option value="mask-hero">Hero</option>
        </select>
      </label>
      <label>Mask/Suit: <input type="color" id="maskColorInp" value="#333333" /></label>
      <label>Skin: <input type="color" id="skinColor" value="#ffcc99" /></label>
      <label>Shirt: <input type="color" id="shirtColor" value="#3498db" /></label>
      <label>Hair: <input type="color" id="hairColor" value="#3e2723" /></label>

      <button onclick="clearCanvas()" style="background: #ffcccc; color: #c0392b">Clear Canvas</button>
      <button onclick="downloadCanvas()" style="background: #ccffcc; color: #27ae60">Download Art</button>

      <p style="font-size: 11px; color: #777; margin-top: 20px">
        The Avatar follows your mouse. Click and drag to paint!
      </p>
    </div>

    <div id="canvasContainer">
      <div id="avatarWrapper">
        <div id="pivot">
          
          <div class="cuboid leg left">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>
          <div class="cuboid leg right">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>

          <div class="cuboid body">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>

          <div class="cuboid neck">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>

          <div class="cuboid head">
            <div class="face front">
              <div class="eye l"></div><div class="eye r"></div>
            </div>
            <div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>

          <div class="cuboid hair">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>
          <div class="cuboid hair-back">
            <div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div>
          </div>

          <div class="cuboid arm left">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
          </div>
          <div class="cuboid arm right">
            <div class="face front"></div><div class="face back"></div>
            <div class="face left"></div><div class="face right"></div>
            <div class="face top"></div><div class="face bottom"></div>
            <div class="brush"></div>
          </div>

        </div>
      </div>
=======
      <div class="group">
        <label>Hair Tone</label>
        <input type="color" id="hairInp" value="#2c3e50" />
        <label style="margin-top: 15px">Eye Tone</label>
        <input type="color" id="eyeInp" value="#3498db" />
      </div>

      <button onclick="clearCanvas()" class="clear">Clear Canvas</button>
      <button onclick="downloadCanvas()">Export Artwork</button>
    </div>

    <div id="canvasContainer">
      <div id="vtuberContainer">
        <svg viewBox="0 0 200 220" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="hairGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop
                offset="0%"
                style="stop-color: var(--hair-highlight); stop-opacity: 1"
              />
              <stop
                offset="90%"
                style="stop-color: var(--hair-base); stop-opacity: 1"
              />
            </linearGradient>
            <linearGradient id="eyeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop
                offset="0%"
                style="stop-color: var(--eye-base); stop-opacity: 1"
              />
              <stop
                offset="100%"
                style="stop-color: var(--eye-dark); stop-opacity: 1"
              />
            </linearGradient>
            <radialGradient
              id="blushGrad"
              cx="50%"
              cy="50%"
              r="50%"
              fx="50%"
              fy="50%"
            >
              <stop
                offset="0%"
                style="stop-color: rgb(255, 186, 186); stop-opacity: 0.6"
              />
              <stop
                offset="100%"
                style="stop-color: rgb(255, 186, 186); stop-opacity: 0"
              />
            </radialGradient>
          </defs>
>>>>>>> Stashed changes

          <path
            d="M40,120 Q30,160 10,180 L50,170 Q80,200 100,190 Q120,200 150,170 L190,180 Q170,160 160,120 Z"
            fill="url(#hairGrad)"
            stroke="#1a2530"
            stroke-width="2"
          />

          <rect x="85" y="150" width="30" height="30" fill="var(--skin-base)" />
          <path
            d="M70,170 L70,210 Q100,220 130,210 L130,170 L100,185 Z"
            fill="#333"
            stroke="#222"
            stroke-width="2"
          />
          <path
            d="M50,80 Q50,150 100,180 Q150,150 150,80 L150,60 Q100,40 50,60 Z"
            fill="var(--skin-base)"
            stroke="#d4a58e"
            stroke-width="1.5"
          />

          <ellipse cx="65" cy="125" rx="12" ry="8" fill="url(#blushGrad)" />
          <ellipse cx="135" cy="125" rx="12" ry="8" fill="url(#blushGrad)" />
          <path d="M100,125 L104,135 L98,135 Z" fill="#e0c0a0" opacity="0.5" />

          <g id="eyeL">
            <path
              d="M60,100 Q75,90 95,100 Q95,125 75,130 Q60,125 60,100 Z"
              fill="#fff"
              stroke="#d4a58e"
              stroke-width="1"
            />
            <path
              d="M58,102 Q75,88 97,102 Q98,98 100,95 L55,98 Z"
              fill="#222"
            />
            <g id="irisL">
              <circle
                cx="78"
                cy="112"
                r="13"
                fill="url(#eyeGrad)"
                stroke="#1a2530"
                stroke-width="1"
              />
              <circle cx="78" cy="112" r="5" fill="#111" />
              <circle cx="82" cy="108" r="3" fill="#fff" opacity="0.9" />
              <circle cx="74" cy="118" r="1.5" fill="#fff" opacity="0.7" />
            </g>
          </g>

          <g id="eyeR">
            <path
              d="M105,100 Q125,90 140,100 Q140,125 125,130 Q105,125 105,100 Z"
              fill="#fff"
              stroke="#d4a58e"
              stroke-width="1"
            />
            <path
              d="M103,102 Q125,88 142,102 Q141,98 145,95 L100,98 Z"
              fill="#222"
            />
            <g id="irisR">
              <circle
                cx="122"
                cy="112"
                r="13"
                fill="url(#eyeGrad)"
                stroke="#1a2530"
                stroke-width="1"
              />
              <circle cx="122" cy="112" r="5" fill="#111" />
              <circle cx="126" cy="108" r="3" fill="#fff" opacity="0.9" />
              <circle cx="118" cy="118" r="1.5" fill="#fff" opacity="0.7" />
            </g>
          </g>

          <path
            d="M95,155 Q100,158 105,155"
            fill="none"
            stroke="#c08a8a"
            stroke-width="2"
            stroke-linecap="round"
          />

          <g id="mask-kitsune" class="hidden">
            <path
              d="M130,70 Q165,65 175,100 Q165,140 135,130"
              fill="#fff"
              stroke="#ddd"
              stroke-width="2"
            />
            <path
              d="M150,90 Q160,85 165,90"
              fill="none"
              stroke="red"
              stroke-width="3"
            />
            <path
              d="M155,115 Q165,120 168,115"
              fill="none"
              stroke="red"
              stroke-width="3"
            />
          </g>

          <path
            d="M50,80 Q40,40 100,30 Q160,40 150,80 L140,130 L120,90 L100,140 L80,90 L60,130 Z"
            fill="url(#hairGrad)"
            stroke="#1a2530"
            stroke-width="1.5"
            filter="drop-shadow(0 2px 2px rgba(0,0,0,0.3))"
          />
        </svg>
      </div>
      <canvas id="paintCanvas"></canvas>
    </div>

    <script>
      const canvas = document.getElementById("paintCanvas");
      const ctx = canvas.getContext("2d");
      const container = document.getElementById("canvasContainer");
      const avatar = document.getElementById("vtuberContainer");
      // Target the entire iris group for tracking, not just the pupil
      const irisL = document.getElementById("irisL");
      const irisR = document.getElementById("irisR");

<<<<<<< Updated upstream
      function resize() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
      }
      window.addEventListener("resize", resize);
      resize();
=======
      let mX = 0,
        mY = 0; // Mouse coords
      let aX = 0,
        aY = 0; // Avatar coords
      let angle = 0;
      let drawing = false;

      function init() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
      }
>>>>>>> Stashed changes

      // Animation Loop
      function loop() {
        angle += 0.025; // Slightly slower orbit for grace
        // Radius of 100px around the brush
        const targetX = mX + Math.cos(angle) * 100;
        const targetY = mY + Math.sin(angle) * 100;

        // Smooth gliding (Lerp)
        aX += (targetX - aX) * 0.1;
        aY += (targetY - aY) * 0.1;

<<<<<<< Updated upstream
      container.addEventListener("mousemove", (e) => {
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Move Avatar (Offset slightly so brush tip hits mouse)
        // With scale(0.35), the math changes slightly, but this is a good estimate
        avatarWrapper.style.transform = `translate(${x - 10}px, ${y - 40}px)`;
=======
        avatar.style.left = aX + "px";
        avatar.style.top = aY + "px";

        // Enhanced Eye Tracking
        // We move the entire iris group relative to its center point
        [
          { el: irisL, cx: 78, cy: 112 },
          { el: irisR, cx: 122, cy: 112 },
        ].forEach((eye) => {
          const dx = mX - aX;
          const dy = mY - aY;
          // Limit how far the iris can move within the eye socket
          const dist = Math.min(5, Math.hypot(dx, dy) / 25);
          const a = Math.atan2(dy, dx);
>>>>>>> Stashed changes

          // Use transform translate instead of setting cx/cy for groups
          eye.el.setAttribute(
            "transform",
            `translate(${Math.cos(a) * dist}, ${Math.sin(a) * dist})`,
          );
        });

<<<<<<< Updated upstream
      container.addEventListener("mousedown", (e) => {
        isDrawing = true;
        pivot.classList.add("walking"); 

        const rect = container.getBoundingClientRect();
        draw(e.clientX - rect.left, e.clientY - rect.top);
      });

      window.addEventListener("mouseup", () => {
        isDrawing = false;
        pivot.classList.remove("walking"); 
        ctx.beginPath(); 
      });

      // --- 3. DRAWING LOGIC ---
      const brushColor = document.getElementById("brushColor");
      const brushSize = document.getElementById("brushSize");
      const brushShape = document.getElementById("brushShape");

      function draw(x, y) {
        ctx.lineWidth = brushSize.value;
        ctx.lineCap = brushShape.value === "round" ? "round" : "butt";
        ctx.strokeStyle = brushColor.value;
        ctx.fillStyle = brushColor.value;

        if (brushShape.value === "square") {
          const s = brushSize.value;
          ctx.fillRect(x - s / 2, y - s / 2, s, s);
        } else {
          ctx.lineTo(x, y);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(x, y);
        }
=======
        requestAnimationFrame(loop);
>>>>>>> Stashed changes
      }

      // Drawing Logic
      container.addEventListener("mousemove", (e) => {
        const r = container.getBoundingClientRect();
        mX = e.clientX - r.left;
        mY = e.clientY - r.top;
        if (drawing) {
          ctx.lineTo(mX, mY);
          ctx.stroke();
        }
      });

      container.addEventListener("mousedown", (e) => {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(mX, mY);
        ctx.strokeStyle = document.getElementById("brushColor").value;
        ctx.lineWidth = document.getElementById("brushSize").value;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
      });
      window.addEventListener("mouseup", () => (drawing = false));

      // Customization Logic
      const root = document.documentElement;
<<<<<<< Updated upstream

      document.getElementById("skinColor").addEventListener("input", (e) =>
          root.style.setProperty("--skin-color", e.target.value));
      document.getElementById("shirtColor").addEventListener("input", (e) =>
          root.style.setProperty("--shirt-color", e.target.value));
      document.getElementById("hairColor").addEventListener("input", (e) =>
          root.style.setProperty("--hair-color", e.target.value));
      document.getElementById("maskColorInp").addEventListener("input", (e) =>
          root.style.setProperty("--mask-color", e.target.value));

      // Mask Toggle
      // We apply class to #pivot or .head, but mostly it affects .head .face
      const avatarContainer = document.getElementById("pivot");
      document.getElementById("maskSelect").addEventListener("change", (e) => {
        // Remove existing mask classes
        avatarContainer.classList.remove("mask-ninja", "mask-hero");
        if(e.target.value !== "none") {
          avatarContainer.classList.add(e.target.value);
        }
      });

      // Brush Visual Update
      const brushVisual = document.querySelector(".brush");
      brushColor.addEventListener("input", (e) => {
        brushVisual.style.background = e.target.value;
=======
      document.getElementById("hairInp").addEventListener("input", (e) => {
        root.style.setProperty("--hair-base", e.target.value);
        // Simple way to create a highlight color from the base
        root.style.setProperty(
          "--hair-highlight",
          lightenColor(e.target.value, 40),
        );
      });
      document.getElementById("eyeInp").addEventListener("input", (e) => {
        root.style.setProperty("--eye-base", e.target.value);
        root.style.setProperty("--eye-dark", darkenColor(e.target.value, 30));
      });

      document.getElementById("maskType").addEventListener("change", (e) => {
        document.getElementById("mask-kitsune").classList.add("hidden");
        if (e.target.value !== "none")
          document
            .getElementById("mask-" + e.target.value)
            .classList.remove("hidden");
>>>>>>> Stashed changes
      });

      // Helper functions for color gradients
      function lightenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16),
          amt = Math.round(2.55 * percent),
          R = (num >> 16) + amt,
          B = ((num >> 8) & 0x00ff) + amt,
          G = (num & 0x0000ff) + amt;
        return (
          "#" +
          (
            0x1000000 +
            (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
            (B < 255 ? (B < 1 ? 0 : B) : 255) * 0x100 +
            (G < 255 ? (G < 1 ? 0 : G) : 255)
          )
            .toString(16)
            .slice(1)
        );
      }
      function darkenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16),
          amt = Math.round(2.55 * percent),
          R = (num >> 16) - amt,
          B = ((num >> 8) & 0x00ff) - amt,
          G = (num & 0x0000ff) - amt;
        return (
          "#" +
          (
            0x1000000 +
            (R > 0 ? R : 0) * 0x10000 +
            (B > 0 ? B : 0) * 0x100 +
            (G > 0 ? G : 0)
          )
            .toString(16)
            .slice(1)
        );
      }

      window.clearCanvas = () =>
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      window.downloadCanvas = () => {
        const link = document.createElement("a");
        link.download = "anime-masterpiece.png";
        link.href = canvas.toDataURL();
        link.click();
      };

      window.addEventListener("resize", init);
      init();
      loop();
    </script>
  </body>
</html>